(this["webpackJsonpsynthesia-react"]=this["webpackJsonpsynthesia-react"]||[]).push([[0],{136:function(t,n,e){},150:function(t,n,e){"use strict";e.r(n);var i,r,s,a,c,o,u,d=e(0),l=e.n(d),f=e(20),h=e.n(f),p=(e(136),e(12)),b=e.n(p),m=e(21),j=e(8),g=e(9),x=e(13),y=e(2),O=e(3),v=e(1),k=Object(O.b)((function(t){var n=t.className;return Object(v.jsx)("div",{className:n})}))(i||(i=Object(y.a)(["\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  padding: 2px;\n  background: "," ","\n"])),(function(t){return t.pressed?"#c9c9c9":"#f6f6f6"}),(function(t){return t.black&&Object(O.a)(r||(r=Object(y.a)(["\n    width: 12px;\n    background: ","\n  "])),(function(t){return t.pressed?"#2d2d2d":"#505050"}))})),T=function(t){return[1,3,6,8,10].some((function(n){return n===t%12}))},P=Array.from(Array(127),(function(t,n){return T(n)})),S=Object(O.b)((function(t){var n=t.className,e=t.start,i=void 0===e?48:e,r=t.end,s=void 0===r?71:r,a=t.pressedKeys,c=void 0===a?[48,50,52]:a,o=P.map((function(t,n){return{index:n,black:t,pressed:c.some((function(t){return t===n}))}})).slice(i,s+1);return Object(v.jsx)("div",{className:n,children:o.map((function(t){return Object(v.jsx)(k,{black:t.black,pressed:t.pressed},t.index)}))})}))(s||(s=Object(y.a)(["\n  height: 50px;\n  display: flex;\n"]))),w=e(25),L=e(26),N=e(27),F={isPlaying:!1,currentNotes:[],notes:[],currentTick:0,tickLength:0},A=function(){function t(n){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(L.a)(this,t),this.midi=n,this.trackToPlay=i,this.speed=r,this.tempo=this.midi.header.tempos[0].bpm,this.currentTick=0,this.isPlaying=!1,this.listeners=[],this.time=0,this.startTime=0,this.animation=0,this.nextState=function(){e.isPlaying&&(e.currentTick=Math.floor(e.time/e.tickLength));var t=e.midi.tracks[e.trackToPlay].notes.map((function(t){var n=t.midi,i=t.duration;return{note:n,position:t.time-e.time,length:i}})),n=t.filter((function(t){return t.position<=0&&-1*t.position<=t.length}));return{currentTick:e.currentTick,notes:t,currentNotes:n,isPlaying:e.isPlaying,tickLength:e.tickLength}},this.passStateToListeners=function(t){e.listeners.forEach((function(n){return n(t)}))},this.onStateChange=function(t){e.listeners.push(t),e.passStateToListeners(e.nextState())},this.play=function(){e.animation=requestAnimationFrame((function(t){e.time>e.midi.tracks[e.trackToPlay].duration?e.stop():(e.isPlaying||(e.startTime=t),e.isPlaying=!0,e.time=(t-e.startTime)/1e3,e.passStateToListeners(e.nextState()),e.play())}))},this.pause=function(){e.isPlaying&&(cancelAnimationFrame(e.animation),e.isPlaying=!1),e.passStateToListeners(e.nextState())},this.stop=function(){cancelAnimationFrame(e.animation),e.isPlaying=!1,e.time=0,e.startTime=0,e.currentTick=0,e.passStateToListeners(e.nextState())}}return Object(N.a)(t,[{key:"tickLength",get:function(){return 60/this.tempo/this.midi.header.ppq*this.speed}}]),t}(),C=e(6),z=e(28),E=O.b.div.attrs((function(t){return{style:{bottom:"".concat(t.position,"px"),height:"".concat(t.size,"px")}}}))(a||(a=Object(y.a)(["\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n  background: #ff7878;\n"]))),I=O.b.div(c||(c=Object(y.a)(["\n  position: relative;\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  border: solid 1px #989797;\n  background: "," ","\n  overflow: no-display;\n"])),(function(t){return t.pressed?"#c9c9c9":"#f6f6f6"}),(function(t){return t.black&&Object(O.a)(o||(o=Object(y.a)(["\n    width: 12px;\n    background: ","\n  "])),(function(t){return t.pressed?"#b2b2b2":"#dedede"}))})),M=function(t,n,e){var i,r=Array(e-n+1).fill([]),s=Object(z.a)(t);try{for(s.s();!(i=s.n()).done;){var a=i.value,c=a.note-n;r.length>c&&(r[c]=[].concat(Object(j.a)(r[c]),[a]))}}catch(o){s.e(o)}finally{s.f()}return r},D=Object(O.b)((function(t){var n=t.notes,e=void 0===n?[]:n,i=t.className,r=t.start,s=void 0===r?48:r,a=t.end,c=void 0===a?71:a;return Object(v.jsx)("div",{className:i,children:M(e,s,c).map((function(t,n){return Object(v.jsx)(I,{black:T(n+s),children:t.map((function(t){return Object(v.jsx)(E,{position:100*t.position,size:100*t.length})}))})}))})}))(u||(u=Object(y.a)(["\n  height: 300px;\n  display: flex;\n  overflow: hidden;\n"]))),q=function(t){var n=t.track,e=void 0===n?1:n,i=function(){var t=Object(d.useState)(C.a.none),n=Object(g.a)(t,2),e=n[0],i=n[1],r=function(){var t=Object(m.a)(b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.Midi.fromUrl("/synthesia-react/example2.mid");case 2:n=t.sent,i(C.a.some(n));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(d.useEffect)((function(){r()}),[]),e}();return C.a.map((function(t){return new A(t,e,.5)}))(i)},B=function(t){var n=t.player,e=Object(d.useState)(F),i=Object(g.a)(e,2),r=i[0],s=i[1],a=r.currentNotes,c=r.isPlaying,o=r.notes;return Object(d.useEffect)((function(){return n.onStateChange(s)}),[n]),Object(v.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(v.jsx)(D,{notes:o}),Object(v.jsx)(S,{pressedKeys:a.map((function(t){return t.note}))}),Object(v.jsx)("button",{onClick:c?n.stop:n.play,children:c?"stop":"play"})]})},J=function(){Object(x.useMIDI)();var t=q({track:1});return C.a.match((function(){return Object(v.jsx)("div",{children:"loading..."})}),(function(t){return Object(v.jsx)(B,{player:t})}))(t)},K=function(t){t&&t instanceof Function&&e.e(3).then(e.bind(null,151)).then((function(n){var e=n.getCLS,i=n.getFID,r=n.getFCP,s=n.getLCP,a=n.getTTFB;e(t),i(t),r(t),s(t),a(t)}))};h.a.render(Object(v.jsx)(l.a.StrictMode,{children:Object(v.jsx)(J,{})}),document.getElementById("root")),K()}},[[150,1,2]]]);
//# sourceMappingURL=main.a14c9ac3.chunk.js.map