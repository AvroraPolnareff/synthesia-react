(this["webpackJsonpsynthesia-react"]=this["webpackJsonpsynthesia-react"]||[]).push([[0],{137:function(t,e,n){},151:function(t,e,n){"use strict";n.r(e);var i,r,s,a,c,o,u,d=n(0),l=n.n(d),f=n(20),p=n.n(f),h=(n(137),n(12)),b=n.n(h),m=n(21),j=n(8),g=n(9),x=n(13),y=n(2),O=n(3),v=n(1),k=Object(O.b)((function(t){var e=t.className;return Object(v.jsx)("div",{className:e})}))(i||(i=Object(y.a)(["\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  padding: 2px;\n  background: "," ","\n"])),(function(t){return t.pressed?"#c9c9c9":"#f6f6f6"}),(function(t){return t.black&&Object(O.a)(r||(r=Object(y.a)(["\n    width: 12px;\n    background: ","\n  "])),(function(t){return t.pressed?"#2d2d2d":"#505050"}))})),T=function(t){return[1,3,6,8,10].some((function(e){return e===t%12}))},P=Array.from(Array(127),(function(t,e){return T(e)})),S=Object(O.b)((function(t){var e=t.className,n=t.start,i=void 0===n?48:n,r=t.end,s=void 0===r?71:r,a=t.pressedKeys,c=void 0===a?[48,50,52]:a,o=P.map((function(t,e){return{index:e,black:t,pressed:c.some((function(t){return t===e}))}})).slice(i,s+1);return Object(v.jsx)("div",{className:e,children:o.map((function(t){return Object(v.jsx)(k,{black:t.black,pressed:t.pressed},t.index)}))})}))(s||(s=Object(y.a)(["\n  height: 50px;\n  display: flex;\n"]))),w=n(25),L=n(26),N=n(27),C=n(28),F={isPlaying:!1,currentNotes:[],notes:[],currentTick:0,tickLength:0},z=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(L.a)(this,t),this.midi=e,this.trackToPlay=i,this.speed=r,this.tempo=this.midi.header.tempos[0].bpm,this.currentTick=0,this.isPlaying=!1,this.listeners=[],this.deltaframe=new C.a({minFps:30,targetFps:144}),this.delta=16.6,this.time=0,this.startTime=0,this.state=F,this.nextState=function(){n.isPlaying&&(n.currentTick=Math.floor(n.time/n.tickLength));var t=n.midi.tracks[n.trackToPlay].notes.map((function(t){var e=t.midi,i=t.duration;return{note:e,position:t.time-n.time,length:i}})),e=t.filter((function(t){return t.position<=0&&-1*t.position<=t.length}));return{currentTick:n.currentTick,notes:t,currentNotes:e,isPlaying:n.isPlaying,tickLength:n.tickLength}},this.passStateToListeners=function(t){n.listeners.forEach((function(e){return e(t)}))},this.onStateChange=function(t){n.listeners.push(t),n.passStateToListeners(n.nextState())},this.play=function(){n.deltaframe.start((function(t,e){n.time>n.midi.tracks[n.trackToPlay].duration?(n.deltaframe.stop(),n.stop()):(n.isPlaying||(n.startTime=t),n.isPlaying=!0,n.time=(t-n.startTime)/1e3,n.delta=e/1e3,n.passStateToListeners(n.nextState()))})),n.deltaframe.resume()},this.pause=function(){n.isPlaying&&(n.isPlaying=!1,n.deltaframe.pause()),n.passStateToListeners(n.nextState())},this.stop=function(){n.deltaframe.stop(),n.isPlaying=!1,n.time=0,n.startTime=0,n.currentTick=0,n.passStateToListeners(n.nextState())}}return Object(N.a)(t,[{key:"tickLength",get:function(){return 60/this.tempo/this.midi.header.ppq*this.speed}}]),t}(),E=n(6),I=n(29),M=O.b.div.attrs((function(t){return{style:{bottom:"".concat(t.position,"px"),height:"".concat(t.size,"px")}}}))(a||(a=Object(y.a)(["\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n  background: #ff7878;\n"]))),A=O.b.div(c||(c=Object(y.a)(["\n  position: relative;\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  border: solid 1px #989797;\n  background: "," ","\n  overflow: no-display;\n"])),(function(t){return t.pressed?"#c9c9c9":"#f6f6f6"}),(function(t){return t.black&&Object(O.a)(o||(o=Object(y.a)(["\n    width: 12px;\n    background: ","\n  "])),(function(t){return t.pressed?"#b2b2b2":"#dedede"}))})),D=function(t,e,n){var i,r=Array(n-e+1).fill([]),s=Object(I.a)(t);try{for(s.s();!(i=s.n()).done;){var a=i.value,c=a.note-e;r.length>c&&(r[c]=[].concat(Object(j.a)(r[c]),[a]))}}catch(o){s.e(o)}finally{s.f()}return r},B=Object(O.b)((function(t){var e=t.notes,n=void 0===e?[]:e,i=t.className,r=t.start,s=void 0===r?48:r,a=t.end,c=void 0===a?71:a;return Object(v.jsx)("div",{className:i,children:D(n,s,c).map((function(t,e){return Object(v.jsx)(A,{black:T(e+s),children:t.map((function(t){return Object(v.jsx)(M,{position:100*t.position,size:100*t.length})}))})}))})}))(u||(u=Object(y.a)(["\n  height: 300px;\n  display: flex;\n  overflow: hidden;\n"]))),J=function(t){var e=t.track,n=void 0===e?1:e,i=function(){var t=Object(d.useState)(E.a.none),e=Object(g.a)(t,2),n=e[0],i=e[1],r=function(){var t=Object(m.a)(b.a.mark((function t(){var e;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.Midi.fromUrl("/synthesia-react/example2.mid");case 2:e=t.sent,i(E.a.some(e));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(d.useEffect)((function(){r()}),[]),n}();return E.a.map((function(t){return new z(t,n,.5)}))(i)},K=function(t){var e=t.player,n=Object(d.useState)(F),i=Object(g.a)(n,2),r=i[0],s=i[1],a=r.currentNotes,c=r.isPlaying,o=r.notes;return Object(d.useEffect)((function(){return e.onStateChange(s)}),[e]),Object(v.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(v.jsx)(B,{notes:o}),Object(v.jsx)(S,{pressedKeys:a.map((function(t){return t.note}))}),Object(v.jsx)("button",{onClick:c?e.stop:e.play,children:c?"stop":"play"})]})},q=function(){Object(x.useMIDI)();var t=J({track:1});return E.a.match((function(){return Object(v.jsx)("div",{children:"loading..."})}),(function(t){return Object(v.jsx)(K,{player:t})}))(t)},U=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,152)).then((function(e){var n=e.getCLS,i=e.getFID,r=e.getFCP,s=e.getLCP,a=e.getTTFB;n(t),i(t),r(t),s(t),a(t)}))};p.a.render(Object(v.jsx)(l.a.StrictMode,{children:Object(v.jsx)(q,{})}),document.getElementById("root")),U()}},[[151,1,2]]]);
//# sourceMappingURL=main.6ceed85a.chunk.js.map