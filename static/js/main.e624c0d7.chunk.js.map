{"version":3,"sources":["features/widgets/keyboard/index.tsx","features/core/event-emitter/index.ts","features/core/animation-core/index.ts","features/core/visual-player/index.ts","features/widgets/note-field/index.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Key","styled","className","pressed","black","css","isBlack","key","some","blackKey","keyboardKeys","Array","from","_","i","Keyboard","start","end","pressedKeys","keys","map","index","pressedKey","slice","EventEmitter","listeners","on","listener","push","remove","filter","subscribed","emit","state","forEach","AnimationCore","animation","isPlaying","isStarted","startTime","time","event","onFrame","loop","requestAnimationFrame","stop","cancelAnimationFrame","pause","Error","resume","initPlayerState","currentNotes","notes","currentTick","tickLength","VisualPlayer","midi","trackToPlay","speed","tempo","this","header","tempos","bpm","onStateChange","tracks","duration","Math","floor","note","position","length","play","ppq","Note","div","attrs","props","style","bottom","height","size","Line","createLines","result","fill","notePosition","NoteField","line","useMIDIPlayer","track","useState","option","none","setMidi","fetchMidi","a","Midi","fromUrl","midiFile","useEffect","useMidiFile","MidiApp","player","playerState","setPlayerState","display","flexDirection","onClick","toFixed","App","useMIDI","match","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e624c0d7.chunk.js","sourcesContent":["import styled, {css} from \"styled-components\"\n\ninterface KeyProps {\n  className?: string\n  black: boolean\n  pressed: boolean\n}\n\nexport const Key = styled(({className}: KeyProps) => {\n\n  return (\n    <div className={className}>\n\n    </div>\n  )\n})`\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  padding: 2px;\n  background: ${({pressed}) => pressed ? \"#c9c9c9\" : \"#f6f6f6\"} ${({black}) => black && css<KeyProps>`\n    width: 12px;\n    background: ${({pressed}) => pressed ? \"#2d2d2d\" : \"#505050\"}\n  `}\n`\n\nexport interface KeyboardProps {\n  className?: string\n  start?: number\n  end?: number\n  pressedKeys?: number[]\n}\n\nexport const isBlack = (key: number) => {\n  const blackKeys = [1, 3, 6, 8, 10]\n  return blackKeys.some(blackKey => blackKey === key % 12)\n}\n\nexport const keyboardKeys = Array.from<unknown, boolean>(Array(127), (_, i) => isBlack(i))\n\nconst Keyboard = styled(\n  ({\n     className,\n     start = 48,\n     end = 71,\n     pressedKeys = [48, 50, 52],\n   }: KeyboardProps) => {\n    const keys = keyboardKeys\n      .map((black, index) => ({index, black, pressed: pressedKeys.some(pressedKey => pressedKey === index)}))\n      .slice(start, end + 1)\n    return (\n      <div className={className}>\n        {keys.map(key => <Key key={key.index} black={key.black} pressed={key.pressed}/>)}\n      </div>\n    )\n  })`\n  height: 50px;\n  display: flex;\n`\n\n\nexport default Keyboard\n","type Listener<T> = (state: T) => void\n\nclass EventEmitter<T> {\n  private listeners: Listener<T>[] = []\n\n  public on = (listener: Listener<T>) => {\n    this.listeners.push(listener)\n  }\n\n  public remove = (listener: Listener<T>) => {\n    this.listeners = this.listeners.filter(subscribed => subscribed !== listener)\n  }\n\n  public emit = (state: T) => {\n    this.listeners.forEach(listener => listener(state))\n  }\n}\n\nexport default EventEmitter\n","import EventEmitter from \"../event-emitter\"\n\ninterface AnimationState {\n  isPlaying: boolean\n  startTime: number\n  time: number\n}\n\n/**\n * requestAnimationFrame wrapper\n */\nclass AnimationCore {\n  private animation = 0\n  private isPlaying = false\n  private isStarted = false\n  private startTime = 0\n  private time = 0\n  private event = new EventEmitter<AnimationState>()\n\n  public onFrame = (listener: (state: AnimationState) => void) => {\n    this.event.on(listener)\n  }\n\n  private loop = (time: number) => {\n    if (!this.isStarted) {\n      this.startTime = time / 1000\n      this.isStarted = true\n    }\n\n    if (this.isPlaying) {\n      this.time = time / 1000 - this.startTime\n      this.event.emit({time: this.time, startTime: this.startTime, isPlaying: this.isPlaying})\n      this.animation = requestAnimationFrame(this.loop)\n    }\n  }\n\n  public start = () => {\n    this.isPlaying = true\n    this.animation = requestAnimationFrame(this.loop)\n  }\n\n  public stop = () => {\n    cancelAnimationFrame(this.animation)\n    this.isPlaying = false\n    this.isStarted = false\n    this.time = 0\n    this.startTime = 0\n    this.event.emit({time: 0, startTime: 0, isPlaying: false})\n  }\n\n  public pause = () => {\n    throw Error(\"not implemented\")\n  }\n\n  public resume = () => {\n    throw Error(\"not implemented\")\n  }\n}\n\nexport default AnimationCore\n","import {Midi} from \"@tonejs/midi\"\nimport AnimationCore from \"../animation-core\"\n\nexport interface DisplayNote {\n  note: number\n  position: number\n  length: number\n}\n\nexport interface PlayerState {\n  isPlaying: boolean,\n  currentNotes: DisplayNote[],\n  currentTick: number,\n  notes: DisplayNote[]\n  tickLength: number\n  time: number\n}\n\nexport const initPlayerState: PlayerState = {\n  isPlaying: false,\n  currentNotes: [],\n  notes: [],\n  currentTick: 0,\n  tickLength: 0,\n  time: 0,\n}\n\n/**\n * Give info about midi notes to an UI\n */\nclass VisualPlayer {\n  constructor(\n    private readonly midi: Midi,\n    private trackToPlay: number = 1,\n    private speed: number = 1,\n  ) { }\n\n  private get tickLength() { return 60 / this.tempo / this.midi.header.ppq * this.speed }\n\n  private tempo = this.midi.header.tempos[0].bpm\n  private currentTick = 0\n  private animation = new AnimationCore()\n\n  public onStateChange = (listener: (state: PlayerState) => void) => {\n    this.animation.onFrame(({time, startTime, isPlaying}) => {\n      if (time > this.midi.tracks[this.trackToPlay].duration) {\n        this.stop()\n      } else {\n        if (isPlaying) this.currentTick = Math.floor(time / this.tickLength)\n\n        const notes = this.midi.tracks[this.trackToPlay].notes\n          .map(({midi, duration, time: noteTime}) => ({note: midi, position: noteTime - time, length: duration}))\n        const currentNotes = notes.filter(note => note.position <= 0 && note.position * -1 <= note.length)\n        listener({\n          currentTick: this.currentTick,\n          notes,\n          currentNotes,\n          isPlaying: isPlaying,\n          tickLength: this.tickLength,\n          time,\n        })\n      }\n\n    })\n\n  }\n\n  public play = () => {\n    this.animation.start()\n  }\n\n  public pause = () => {\n    this.animation.pause()\n  }\n\n  public stop = () => {\n    this.animation.stop()\n  }\n\n  public resume = () => {\n    this.animation.resume()\n  }\n}\n\nexport default VisualPlayer;\n","import {DisplayNote} from \"../../core/visual-player\"\nimport styled, {css} from \"styled-components\"\nimport {isBlack} from \"../keyboard\"\n\ninterface NoteProps {\n  position: number\n  size: number\n}\nconst Note = styled.div.attrs((props: NoteProps) => ({\n  style: {bottom: `${props.position}px`, height: `${props.size}px`}\n}))<NoteProps>`\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n  background: #ff7878;\n`\n\ninterface LineProps {\n  black: boolean,\n  pressed?: boolean,\n}\n\nconst Line = styled.div<LineProps>`\n  position: relative;\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  border: solid 1px #989797;\n  background: ${({pressed}) => pressed ? \"#c9c9c9\" : \"#f6f6f6\"} ${({black}) => black && css<LineProps>`\n    width: 12px;\n    background: ${({pressed}) => pressed ? \"#b2b2b2\" : \"#dedede\"}\n  `}\n  overflow: no-display;\n`\n\ninterface NoteFieldProps {\n  notes: DisplayNote[]\n  className?: string\n  start?: number\n  end?: number\n}\n\nconst createLines = (notes: DisplayNote[], start: number, end: number) => {\n  let result: DisplayNote[][] = Array(end - start + 1).fill([])\n  for (const note of notes) {\n    const notePosition = note.note - start\n    if (result.length > notePosition) result[notePosition] = [...result[notePosition], note]\n  }\n  return result\n}\n\nconst NoteField = styled(({notes = [], className, start = 48, end = 71}: NoteFieldProps) => {\n\n  return (\n    <div className={className}>\n      {createLines(notes, start, end).map((line, i) =>\n        <Line black={isBlack(i + start)}>\n          {line.map(note => <Note position={note.position * 100} size={note.length * 100}/>)}\n        </Line>\n      )}\n    </div>\n  )\n})`\n  height: 300px;\n  display: flex;\n  overflow: hidden;\n`\n\n\n\nexport default NoteField\n","import React, {useEffect, useRef, useState} from 'react'\nimport {Input, MIDIFilter, MIDINote, useMIDI, useMIDINote} from \"@react-midi/hooks\"\nimport Keyboard from \"./features/widgets/keyboard\"\nimport {Midi} from \"@tonejs/midi\"\nimport VisualPlayer, {initPlayerState} from \"./features/core/visual-player\"\nimport {option} from \"fp-ts\"\nimport {Option} from \"fp-ts/es6/Option\"\nimport NoteField from \"./features/widgets/note-field\"\n\nexport const useMIDINotes = (input: Input, filter: MIDIFilter = {}) => {\n  const [notes, setNotes] = useState<MIDINote[]>([])\n  const value = useMIDINote(input, filter)\n  useEffect(() => {\n    if (!input) return\n    if (value?.on) setNotes(notes => [...notes, value])\n    else setNotes(notes => notes.filter((n) => n.note !== value.note)) // Note off, remove note from array (maybe\n                                                                        // check for channel?)\n  }, [input, value])\n  return notes\n}\n\nexport const useMidiFile = (): Option<Midi> => {\n  const [midi, setMidi] = useState<Option<Midi>>(option.none)\n\n  const fetchMidi = async () => {\n    const midiFile = await Midi.fromUrl(`/synthesia-react/example2.mid`)\n\n    setMidi(option.some(midiFile))\n  }\n\n  useEffect(() => {\n    fetchMidi()\n  }, [])\n  return midi;\n}\n\n\nexport const useMIDIPlayer = ({track = 1}: { track: number }) => {\n  const midi = useMidiFile()\n  return option.map((midi: Midi) => new VisualPlayer(midi, track, 0.5))(midi)\n}\n\nconst MidiApp = ({player}: {player: VisualPlayer}) => {\n  const [playerState, setPlayerState] = useState(initPlayerState);\n  const {currentNotes, isPlaying, notes} = playerState;\n  useEffect(() => player.onStateChange(setPlayerState), [player])\n\n  return (\n    <div style={{display: \"flex\", flexDirection: \"column\"}}>\n      <NoteField notes={notes}/>\n      <Keyboard pressedKeys={currentNotes.map(({note}) => note)}/>\n      <button onClick={isPlaying ? player.stop : player.play}>\n        {isPlaying ? \"stop\" : \"play\"}\n      </button>\n      <h1>{playerState.time.toFixed(3)}</h1>\n    </div>\n  )\n}\n\nconst App = () => {\n  const midi = useMIDI()\n  const player = useMIDIPlayer({track: 1})\n\n  return option.match(\n    () => <div>loading...</div>,\n    (player: VisualPlayer) => <MidiApp player={player}/>\n  )(player)\n}\n\n\n\nexport default App\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App/>\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}