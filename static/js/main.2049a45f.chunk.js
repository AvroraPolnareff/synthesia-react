(this["webpackJsonpsynthesia-react"]=this["webpackJsonpsynthesia-react"]||[]).push([[0],{136:function(t,n,e){},150:function(t,n,e){"use strict";e.r(n);var i,r,o,s,c,a,u,d=e(0),h=e.n(d),f=e(21),l=e.n(f),m=(e(136),e(13)),p=e.n(m),b=e(22),j=e(9),g=e(10),v=e(14),O=e(2),y=e(3),x=e(1),k=Object(y.b)((function(t){var n=t.className;return Object(x.jsx)("div",{className:n})}))(i||(i=Object(O.a)(["\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  padding: 2px;\n  background: "," ","\n"])),(function(t){return t.pressed?"#c9c9c9":"#f6f6f6"}),(function(t){return t.black&&Object(y.a)(r||(r=Object(O.a)(["\n    width: 12px;\n    background: ","\n  "])),(function(t){return t.pressed?"#2d2d2d":"#505050"}))})),w=function(t){return[1,3,6,8,10].some((function(n){return n===t%12}))},P=Array.from(Array(127),(function(t,n){return w(n)})),S=Object(y.b)((function(t){var n=t.className,e=t.start,i=void 0===e?48:e,r=t.end,o=void 0===r?71:r,s=t.pressedKeys,c=void 0===s?[48,50,52]:s,a=P.map((function(t,n){return{index:n,black:t,pressed:c.some((function(t){return t===n}))}})).slice(i,o+1);return Object(x.jsx)("div",{className:n,children:a.map((function(t){return Object(x.jsx)(k,{black:t.black,pressed:t.pressed},t.index)}))})}))(o||(o=Object(O.a)(["\n  height: 50px;\n  display: flex;\n"]))),T=e(26),N=e(5),F=e(27),E=function t(){var n=this;Object(N.a)(this,t),this.listeners=[],this.on=function(t){n.listeners.push(t)},this.remove=function(t){n.listeners=n.listeners.filter((function(n){return n!==t}))},this.emit=function(t){n.listeners.forEach((function(n){return n(t)}))}},L=function t(){var n=this;Object(N.a)(this,t),this.animation=0,this.isPlaying=!1,this.isStarted=!1,this.startTime=0,this.time=0,this.event=new E,this.onFrame=function(t){n.event.on(t)},this.loop=function(t){!n.isStarted&&n.isPlaying&&(n.startTime=t/1e3,n.isStarted=!0),n.isPlaying&&(n.time=t/1e3-n.startTime,n.event.emit({time:n.time,startTime:n.startTime,isPlaying:n.isPlaying}),n.animation=requestAnimationFrame(n.loop))},this.start=function(){n.isPlaying=!0,n.animation=requestAnimationFrame(n.loop)},this.stop=function(){cancelAnimationFrame(n.animation),n.isPlaying=!1,n.isStarted=!1,n.time=0,n.startTime=0,n.event.emit({time:0,startTime:0,isPlaying:!1})},this.pause=function(){throw Error("not implemented")},this.resume=function(){throw Error("not implemented")}},A={isPlaying:!1,currentNotes:[],currentNotesStart:[],currentNotesEnd:[],notes:[],currentTick:0,tickLength:0,time:0},C=function(){function t(n){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16;Object(N.a)(this,t),this.midi=n,this.trackToPlay=i,this.speed=r,this.window=o,this.tempo=this.midi.header.tempos[0].bpm,this.currentTick=0,this.animation=new L,this.onStateChange=function(t){e.animation.onFrame((function(n){var i=n.time,r=n.isPlaying;if(i>e.midi.tracks[e.trackToPlay].duration)e.stop();else{e.currentTick=Math.floor(i/e.tickLength);var o=e.midi.tracks[e.trackToPlay].notes.map((function(t){var n=t.midi,e=t.duration;return{note:n,position:t.time-i,length:e}})),s=o.filter((function(t){var n=t.length,e=t.position;return e<=0&&-1*e<=n})),c=o.filter((function(t){var n=t.position;return n<=e.windowSeconds&&-1*n<=e.windowSeconds})),a=o.filter((function(t){var n=t.length,i=t.position;return i<=-n+e.windowSeconds&&-1*i<=n+e.windowSeconds}));t({currentTick:e.currentTick,notes:o,currentNotes:s,currentNotesStart:c,currentNotesEnd:a,isPlaying:r,tickLength:e.tickLength,time:i})}}))},this.play=function(){e.animation.start()},this.pause=function(){e.animation.pause()},this.stop=function(){e.animation.stop()},this.resume=function(){e.animation.resume()}}return Object(F.a)(t,[{key:"tickLength",get:function(){return 60/this.tempo/this.midi.header.ppq*this.speed}},{key:"windowSeconds",get:function(){return this.tickLength*this.window}}]),t}(),z=C,I=e(7),M=e(28),q=y.b.div.attrs((function(t){return{style:{bottom:"".concat(t.position,"px"),height:"".concat(t.size,"px")}}}))(s||(s=Object(O.a)(["\n  position: absolute;\n  width: 100%;\n  bottom: 0;\n  background: #ff7878;\n"]))),D=y.b.div(c||(c=Object(O.a)(["\n  position: relative;\n  box-sizing: border-box;\n  width: 20px;\n  height: 100%;\n  border: solid 1px #989797;\n  background: "," ","\n  overflow: no-display;\n"])),(function(t){return t.pressed?"#c9c9c9":"#f6f6f6"}),(function(t){return t.black&&Object(y.a)(a||(a=Object(O.a)(["\n    width: 12px;\n    background: ","\n  "])),(function(t){return t.pressed?"#b2b2b2":"#dedede"}))})),B=function(t,n,e){var i,r=Array(e-n+1).fill([]),o=Object(M.a)(t);try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.note-n;r.length>c&&(r[c]=[].concat(Object(j.a)(r[c]),[s]))}}catch(a){o.e(a)}finally{o.f()}return r},J=Object(y.b)((function(t){var n=t.notes,e=void 0===n?[]:n,i=t.className,r=t.start,o=void 0===r?48:r,s=t.end,c=void 0===s?71:s;return Object(x.jsx)("div",{className:i,children:B(e,o,c).map((function(t,n){return Object(x.jsx)(D,{black:w(n+o),children:t.map((function(t){return Object(x.jsx)(q,{position:100*t.position,size:100*t.length})}))})}))})}))(u||(u=Object(O.a)(["\n  height: 300px;\n  display: flex;\n  overflow: hidden;\n"]))),K=function(t){var n=t.track,e=void 0===n?1:n,i=function(){var t=Object(d.useState)(I.a.none),n=Object(g.a)(t,2),e=n[0],i=n[1],r=function(){var t=Object(b.a)(p.a.mark((function t(){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T.Midi.fromUrl("/synthesia-react/example2.mid");case 2:n=t.sent,i(I.a.some(n));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(d.useEffect)((function(){r()}),[]),e}();return I.a.map((function(t){return new z(t,e,.5)}))(i)},U=function(t){var n=t.player,e=Object(d.useState)(A),i=Object(g.a)(e,2),r=i[0],o=i[1],s=r.currentNotes,c=r.isPlaying,a=r.notes;return Object(d.useEffect)((function(){n.onStateChange(o)}),[n]),Object(x.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(x.jsx)(J,{notes:a}),Object(x.jsx)(S,{pressedKeys:s.map((function(t){return t.note}))}),Object(x.jsx)("button",{onClick:c?n.stop:n.play,children:c?"stop":"play"}),Object(x.jsx)("h1",{children:r.time.toFixed(3)})]})},G=function(){Object(v.useMIDI)();var t=K({track:1});return I.a.match((function(){return Object(x.jsx)("div",{children:"loading..."})}),(function(t){return Object(x.jsx)(U,{player:t})}))(t)},H=function(t){t&&t instanceof Function&&e.e(3).then(e.bind(null,151)).then((function(n){var e=n.getCLS,i=n.getFID,r=n.getFCP,o=n.getLCP,s=n.getTTFB;e(t),i(t),r(t),o(t),s(t)}))};l.a.render(Object(x.jsx)(h.a.StrictMode,{children:Object(x.jsx)(G,{})}),document.getElementById("root")),H()}},[[150,1,2]]]);
//# sourceMappingURL=main.2049a45f.chunk.js.map